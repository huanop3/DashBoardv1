@page "/"
@rendermode InteractiveServer

<PageTitle>Dashboard</PageTitle>

<div class="dashboard-container">
    <!-- Stats Grid -->
    <div class="stats-grid">
        <!-- Total Sessions Card -->
        <div class="stats-card stats-card-large">
            <div class="stats-card-header">
                <div class="stats-header-left">
                    <div class="stats-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z"/>
                            <path d="M12 6V12L16 14"/>
                        </svg>
                    </div>
                    <span class="stats-title">Total sessions</span>
                </div>
                <div class="stats-header-right">
                    <span class="stats-link">View report</span>
                    <span class="stats-period">Last 12 months</span>
                    <div class="stats-divider"></div>
                </div>
            </div>
            <div class="stats-value-wrapper">
                <h2 class="stats-value">400</h2>
                <div class="stats-badge stats-badge-positive">
                    <span>16.8%</span>
                    <svg width="12" height="12" viewBox="0 0 16 16" fill="none">
                        <path d="M2 14L14 2M14 2H6M14 2V10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </div>
            <div class="stats-chart" id="lineChart">
                <!-- Line chart -->
                <svg class="chart-svg" viewBox="0 0 420 140">
                    <!-- Grid lines - horizontal -->
                    <line x1="20" y1="120" x2="400" y2="120" stroke="#2D3142" stroke-width="1" opacity="0.6"/>
                    <line x1="20" y1="90" x2="400" y2="90" stroke="#2D3142" stroke-width="0.5" opacity="0.3"/>
                    <line x1="20" y1="60" x2="400" y2="60" stroke="#2D3142" stroke-width="0.5" opacity="0.3"/>
                    <line x1="20" y1="30" x2="400" y2="30" stroke="#2D3142" stroke-width="0.5" opacity="0.3"/>
                    
                    <!-- Vertical guide lines for X axis -->
                    <line x1="67" y1="20" x2="67" y2="120" stroke="#2D3142" stroke-width="0.5" opacity="0.15"/>
                    <line x1="162" y1="20" x2="162" y2="120" stroke="#2D3142" stroke-width="0.5" opacity="0.15"/>
                    <line x1="257" y1="20" x2="257" y2="120" stroke="#2D3142" stroke-width="0.5" opacity="0.15"/>
                    <line x1="352" y1="20" x2="352" y2="120" stroke="#2D3142" stroke-width="0.5" opacity="0.15"/>
                    
                    <!-- Gradient for area fill -->
                    <defs>
                        <linearGradient id="lineGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#6C72FF;stop-opacity:0.3" />
                            <stop offset="100%" style="stop-color:#6C72FF;stop-opacity:0" />
                        </linearGradient>
                    </defs>
                    
                    <!-- Area fill -->
                    <path class="chart-area" d="M20,100 L67,90 L114,105 L162,80 L210,95 L257,75 L305,85 L352,65 L400,70 L400,120 L20,120 Z" 
                          fill="url(#lineGradient)" opacity="0.6"/>
                    
                    <!-- Line -->
                    <polyline class="chart-line" points="20,100 67,90 114,105 162,80 210,95 257,75 305,85 352,65 400,70" 
                              fill="none" stroke="#6C72FF" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                    
                    <!-- Data points - evenly spaced -->
                    <circle class="chart-point chart-point-1" cx="20" cy="100" r="4" fill="#6C72FF" data-value="320"/>
                    <circle class="chart-point chart-point-2" cx="67" cy="90" r="4" fill="#6C72FF" data-value="340"/>
                    <circle class="chart-point chart-point-3" cx="114" cy="105" r="4" fill="#6C72FF" data-value="310"/>
                    <circle class="chart-point chart-point-4" cx="162" cy="80" r="4" fill="#6C72FF" data-value="360"/>
                    <circle class="chart-point chart-point-5" cx="210" cy="95" r="4" fill="#6C72FF" data-value="330"/>
                    <circle class="chart-point chart-point-6" cx="257" cy="75" r="4" fill="#6C72FF" data-value="370"/>
                    <circle class="chart-point chart-point-7" cx="305" cy="85" r="4" fill="#6C72FF" data-value="350"/>
                    <circle class="chart-point chart-point-8" cx="352" cy="65" r="4" fill="#6C72FF" data-value="390"/>
                    <circle class="chart-point chart-point-9" cx="400" cy="70" r="4" fill="#6C72FF" data-value="380"/>
                </svg>
                <div class="chart-tooltip" id="lineTooltip"></div>
                <div class="chart-y-axis">
                    <span>500</span>
                    <span>250</span>
                    <span>100</span>
                    <span>0</span>
                </div>
                <div class="chart-x-axis">
                    <span>12 AM</span>
                    <span>8 AM</span>
                    <span>4 PM</span>
                    <span>11 PM</span>
                </div>
            </div>
            <div class="stats-footer">
                <div class="stats-live">
                    <span class="live-badge">
                        <span class="live-dot"></span>
                        Live
                    </span>
                    <span class="live-count">10k visitors</span>
                </div>
            </div>
        </div>

        <!-- Total Profit Card -->
        <div class="stats-card stats-card-large">
            <div class="stats-card-header">
                <div class="stats-header-left">
                    <div class="stats-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7L12 12L22 7L12 2Z"/>
                            <path d="M2 17L12 22L22 17"/>
                            <path d="M2 12L12 17L22 12"/>
                        </svg>
                    </div>
                    <span class="stats-title">Total profit</span>
                </div>
                <div class="stats-header-right">
                    <span class="stats-link">View report</span>
                    <span class="stats-period">Last 12 months</span>
                    <div class="stats-divider"></div>
                </div>
            </div>
            <div class="stats-value-wrapper">
                <h2 class="stats-value">$144.6K</h2>
                <div class="stats-badge stats-badge-positive">
                    <span>28.5%</span>
                    <svg width="12" height="12" viewBox="0 0 16 16" fill="none">
                        <path d="M2 14L14 2M14 2H6M14 2V10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </div>
            <div class="stats-chart" id="barChart">
                <!-- Bar chart -->
                <svg class="chart-svg" viewBox="0 0 420 140">
                    <!-- Grid lines - horizontal -->
                    <line x1="20" y1="120" x2="400" y2="120" stroke="#2D3142" stroke-width="1" opacity="0.6"/>
                    <line x1="20" y1="90" x2="400" y2="90" stroke="#2D3142" stroke-width="0.5" opacity="0.3"/>
                    <line x1="20" y1="60" x2="400" y2="60" stroke="#2D3142" stroke-width="0.5" opacity="0.3"/>
                    <line x1="20" y1="30" x2="400" y2="30" stroke="#2D3142" stroke-width="0.5" opacity="0.3"/>
                    
                    <!-- Vertical guide lines for X axis -->
                    <line x1="58" y1="20" x2="58" y2="120" stroke="#2D3142" stroke-width="0.5" opacity="0.15"/>
                    <line x1="153" y1="20" x2="153" y2="120" stroke="#2D3142" stroke-width="0.5" opacity="0.15"/>
                    <line x1="248" y1="20" x2="248" y2="120" stroke="#2D3142" stroke-width="0.5" opacity="0.15"/>
                    <line x1="343" y1="20" x2="343" y2="120" stroke="#2D3142" stroke-width="0.5" opacity="0.15"/>
                    
                    <!-- Bars with animation - evenly spaced -->
                    <rect class="chart-bar" x="28" y="120" width="28" height="0" fill="#6C72FF" rx="4" data-height="40" data-value="$12.5K">
                        <animate attributeName="height" from="0" to="40" dur="0.6s" fill="freeze" begin="0.1s"/>
                        <animate attributeName="y" from="120" to="80" dur="0.6s" fill="freeze" begin="0.1s"/>
                    </rect>
                    <rect class="chart-bar" x="75" y="120" width="28" height="0" fill="#6C72FF" rx="4" data-height="55" data-value="$15.8K">
                        <animate attributeName="height" from="0" to="55" dur="0.6s" fill="freeze" begin="0.2s"/>
                        <animate attributeName="y" from="120" to="65" dur="0.6s" fill="freeze" begin="0.2s"/>
                    </rect>
                    <rect class="chart-bar" x="123" y="120" width="28" height="0" fill="#6C72FF" rx="4" data-height="70" data-value="$18.2K">
                        <animate attributeName="height" from="0" to="70" dur="0.6s" fill="freeze" begin="0.3s"/>
                        <animate attributeName="y" from="120" to="50" dur="0.6s" fill="freeze" begin="0.3s"/>
                    </rect>
                    <rect class="chart-bar" x="170" y="120" width="28" height="0" fill="#6C72FF" rx="4" data-height="50" data-value="$14.3K">
                        <animate attributeName="height" from="0" to="50" dur="0.6s" fill="freeze" begin="0.4s"/>
                        <animate attributeName="y" from="120" to="70" dur="0.6s" fill="freeze" begin="0.4s"/>
                    </rect>
                    <rect class="chart-bar" x="218" y="120" width="28" height="0" fill="#6C72FF" rx="4" data-height="65" data-value="$17.1K">
                        <animate attributeName="height" from="0" to="65" dur="0.6s" fill="freeze" begin="0.5s"/>
                        <animate attributeName="y" from="120" to="55" dur="0.6s" fill="freeze" begin="0.5s"/>
                    </rect>
                    <rect class="chart-bar" x="265" y="120" width="28" height="0" fill="#6C72FF" rx="4" data-height="45" data-value="$13.2K">
                        <animate attributeName="height" from="0" to="45" dur="0.6s" fill="freeze" begin="0.6s"/>
                        <animate attributeName="y" from="120" to="75" dur="0.6s" fill="freeze" begin="0.6s"/>
                    </rect>
                    <rect class="chart-bar" x="313" y="120" width="28" height="0" fill="#6C72FF" rx="4" data-height="60" data-value="$16.5K">
                        <animate attributeName="height" from="0" to="60" dur="0.6s" fill="freeze" begin="0.7s"/>
                        <animate attributeName="y" from="120" to="60" dur="0.6s" fill="freeze" begin="0.7s"/>
                    </rect>
                    <rect class="chart-bar" x="360" y="120" width="28" height="0" fill="#6C72FF" rx="4" data-height="75" data-value="$19.4K">
                        <animate attributeName="height" from="0" to="75" dur="0.6s" fill="freeze" begin="0.8s"/>
                        <animate attributeName="y" from="120" to="45" dur="0.6s" fill="freeze" begin="0.8s"/>
                    </rect>
                </svg>
                <div class="chart-tooltip" id="barTooltip"></div>
                <div class="chart-x-axis">
                    <span>12 AM</span>
                    <span>8 AM</span>
                    <span>4 PM</span>
                    <span>11 PM</span>
                </div>
            </div>
        </div>

        <!-- Small Stats Cards -->
        <div class="stats-card stats-card-small">
            <div class="stats-small-header">
                <div class="stats-icon stats-icon-sm">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12S5 4 12 4S23 12 23 12S19 20 12 20S1 12 1 12Z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                </div>
                <span class="stats-title-sm">Views</span>
                <button class="stats-menu-btn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <circle cx="8" cy="2" r="1.5"/>
                        <circle cx="8" cy="8" r="1.5"/>
                        <circle cx="8" cy="14" r="1.5"/>
                    </svg>
                </button>
            </div>
            <div class="stats-small-value">
                <h3>1.2M</h3>
                <div class="stats-badge stats-badge-positive stats-badge-sm">
                    <span>12.5%</span>
                    <svg width="10" height="10" viewBox="0 0 16 16" fill="none">
                        <path d="M2 14L14 2M14 2H6M14 2V10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </div>
        </div>

        <div class="stats-card stats-card-small">
            <div class="stats-small-header">
                <div class="stats-icon stats-icon-sm">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M16 21V19C16 17.9391 15.5786 16.9217 14.8284 16.1716C14.0783 15.4214 13.0609 15 12 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21"/>
                        <circle cx="8.5" cy="7" r="4"/>
                        <path d="M20 8V14M23 11H17"/>
                    </svg>
                </div>
                <span class="stats-title-sm">Signups</span>
                <button class="stats-menu-btn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <circle cx="8" cy="2" r="1.5"/>
                        <circle cx="8" cy="8" r="1.5"/>
                        <circle cx="8" cy="14" r="1.5"/>
                    </svg>
                </button>
            </div>
            <div class="stats-small-value">
                <h3>8.4K</h3>
                <div class="stats-badge stats-badge-negative stats-badge-sm">
                    <span>-2.4%</span>
                    <svg width="10" height="10" viewBox="0 0 16 16" fill="none">
                        <path d="M14 2L2 14M2 14H10M2 14V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </div>
        </div>

        <div class="stats-card stats-card-small">
            <div class="stats-small-header">
                <div class="stats-icon stats-icon-sm">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 2L3 6V20C3 20.5304 3.21071 21.0391 3.58579 21.4142C3.96086 21.7893 4.46957 22 5 22H19C19.5304 22 20.0391 21.7893 20.4142 21.4142C20.7893 21.0391 21 20.5304 21 20V6L18 2H6Z"/>
                        <path d="M3 6H21M16 10C16 11.0609 15.5786 12.0783 14.8284 12.8284C14.0783 13.5786 13.0609 14 12 14C10.9391 14 9.92172 13.5786 9.17157 12.8284C8.42143 12.0783 8 11.0609 8 10"/>
                    </svg>
                </div>
                <span class="stats-title-sm">Sales</span>
                <button class="stats-menu-btn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <circle cx="8" cy="2" r="1.5"/>
                        <circle cx="8" cy="8" r="1.5"/>
                        <circle cx="8" cy="14" r="1.5"/>
                    </svg>
                </button>
            </div>
            <div class="stats-small-value">
                <h3>$96.8K</h3>
                <div class="stats-badge stats-badge-warning stats-badge-sm">
                    <span>0.0%</span>
                </div>
            </div>
        </div>

        <div class="stats-card stats-card-small">
            <div class="stats-small-header">
                <div class="stats-icon stats-icon-sm">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                </div>
                <span class="stats-title-sm">Events</span>
                <button class="stats-menu-btn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <circle cx="8" cy="2" r="1.5"/>
                        <circle cx="8" cy="8" r="1.5"/>
                        <circle cx="8" cy="14" r="1.5"/>
                    </svg>
                </button>
            </div>
            <div class="stats-small-value">
                <h3>124</h3>
                <div class="stats-badge stats-badge-positive stats-badge-sm">
                    <span>8.2%</span>
                    <svg width="10" height="10" viewBox="0 0 16 16" fill="none">
                        <path d="M2 14L14 2M14 2H6M14 2V10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <!-- Tasks Table -->
    <div class="tasks-section">
        <div class="tasks-header">
            <div class="tasks-header-left">
                <h3 class="tasks-title">Tasks</h3>
                <span class="tasks-count">24 tasks</span>
            </div>
            <div class="tasks-header-right">
                <button class="btn-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                </button>
                <button class="btn-secondary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    Add task
                </button>
            </div>
        </div>
        <div class="tasks-table">
            <table>
                <thead>
                    <tr>
                        <th class="th-checkbox">
                            <input type="checkbox" class="custom-checkbox" @bind="selectAll" @bind:after="HandleSelectAllChange" />
                        </th>
                        <th>Task name</th>
                        <th>Status</th>
                        <th>Due date</th>
                        <th>Assignee</th>
                        <th class="th-actions"></th>
                    </tr>
                </thead>
                <tbody>
                    @for (int i = 0; i < 8; i++)
                    {
                        var index = i;
                        string[] taskNames = new string[] {
                            "Design new landing page",
                            "Fix login bug",
                            "Update user profile UI",
                            "Implement dashboard stats",
                            "Refactor API endpoints",
                            "Write unit tests",
                            "Optimize images",
                            "Deploy to production"
                        };
                        <tr>
                            <td class="td-checkbox">
                                <input type="checkbox" class="custom-checkbox" @bind="taskChecked[index]" @bind:after="() => HandleTaskCheckChange(index)" />
                            </td>
                            <td class="td-task-name">
                                <span>@taskNames[index]</span>
                            </td>
                            <td>
                                <span class="status-badge status-@(i % 3 == 0 ? "done" : i % 3 == 1 ? "progress" : "pending")">
                                    @(i % 3 == 0 ? "Done" : i % 3 == 1 ? "In progress" : "Pending")
                                </span>
                            </td>
                            <td class="td-date">Dec @((i + 1) * 3), 2024</td>
                            <td class="td-assignee">
                                <div class="assignee-avatar">JC</div>
                            </td>
                            <td class="td-actions">
                                <button class="btn-icon-sm">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                        <circle cx="8" cy="2" r="1.5"/>
                                        <circle cx="8" cy="8" r="1.5"/>
                                        <circle cx="8" cy="14" r="1.5"/>
                                    </svg>
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@code {
    private bool selectAll;
    private List<bool> taskChecked = new List<bool> { false, false, false, false, false, false, false, false };

    private void HandleSelectAllChange()
    {
        for (int i = 0; i < taskChecked.Count; i++)
        {
            taskChecked[i] = selectAll;
        }
    }

    private void HandleTaskCheckChange(int index)
    {
        selectAll = taskChecked.All(x => x);
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JS.InvokeVoidAsync("eval", @"
                (function() {
                    setTimeout(function() {
                        // Helper function to position tooltip
                        function positionTooltip(element, tooltip, offsetY) {
                            const rect = element.getBoundingClientRect();
                            const chartContainer = element.closest('.stats-chart');
                            const containerRect = chartContainer.getBoundingClientRect();
                            
                            // Calculate position relative to chart container
                            const x = rect.left - containerRect.left + (rect.width / 2);
                            const y = rect.top - containerRect.top + offsetY;
                            
                            tooltip.style.left = x + 'px';
                            tooltip.style.top = y + 'px';
                        }
                        
                        // Line Chart Tooltip
                        const lineChart = document.getElementById('lineChart');
                        const lineTooltip = document.getElementById('lineTooltip');
                        const linePoints = lineChart?.querySelectorAll('.chart-point');
                        
                        if (linePoints && lineChart) {
                            linePoints.forEach(point => {
                                point.addEventListener('mouseenter', function(e) {
                                    const value = this.getAttribute('data-value');
                                    lineTooltip.innerHTML = '<div style=""display:flex;align-items:center;gap:6px;""><svg width=""10"" height=""10""><circle cx=""5"" cy=""5"" r=""4"" fill=""white"" opacity=""0.9""/></svg><span>' + value + ' sessions</span></div>';
                                    lineTooltip.style.display = 'block';
                                    
                                    // Position tooltip
                                    positionTooltip(this, lineTooltip, -45);
                                    
                                    // Animate point
                                    this.setAttribute('r', '7');
                                    this.style.fill = '#FFFFFF';
                                    this.style.filter = 'drop-shadow(0 0 12px rgba(108, 114, 255, 0.9))';
                                });
                                
                                point.addEventListener('mouseleave', function() {
                                    lineTooltip.style.display = 'none';
                                    this.setAttribute('r', '4');
                                    this.style.fill = '#6C72FF';
                                    this.style.filter = 'none';
                                });
                            });
                        }
                        
                        // Bar Chart Tooltip
                        const barChart = document.getElementById('barChart');
                        const barTooltip = document.getElementById('barTooltip');
                        const bars = barChart?.querySelectorAll('.chart-bar');
                        
                        if (bars && barChart) {
                            bars.forEach(bar => {
                                bar.addEventListener('mouseenter', function(e) {
                                    const value = this.getAttribute('data-value');
                                    barTooltip.innerHTML = '<div style=""display:flex;align-items:center;gap:6px;""><svg width=""12"" height=""12""><rect x=""2"" y=""2"" width=""8"" height=""8"" rx=""2"" fill=""white"" opacity=""0.9""/></svg><span>' + value + '</span></div>';
                                    barTooltip.style.display = 'block';
                                    
                                    // Position tooltip
                                    positionTooltip(this, barTooltip, -25);
                                    
                                    // Animate bar
                                    this.style.opacity = '0.85';
                                    this.style.filter = 'drop-shadow(0 0 16px rgba(108, 114, 255, 0.8)) brightness(1.1)';
                                });
                                
                                bar.addEventListener('mouseleave', function() {
                                    barTooltip.style.display = 'none';
                                    this.style.opacity = '1';
                                    this.style.filter = 'drop-shadow(0 2px 6px rgba(108, 114, 255, 0.2))';
                                });
                            });
                        }
                    }, 200);
                })();
            ");
        }
    }
}

@inject IJSRuntime JS
